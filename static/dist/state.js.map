{"version":3,"sources":["../client/state.js"],"names":[],"mappings":"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","file":"state.js","sourcesContent":["var MAIN_VIEW = 'MAIN_VIEW';\nvar GAME_VIEW = 'GAME_VIEW';\nvar LOADING_VIEW = 'LOADING_VIEW';\nvar ERROR_VIEW = 'ERROR_VIEW';\n\nvar urlHash = window.location.hash.substr(1);\nvar gameId = '';\nif (urlHash.search('game') > -1) {\n    gameId = urlHash.split('/')[1];\n}\n\nvar myGames = [];\nif(supports_html5_storage()) {\n    if(localStorage.games) {\n        myGames = localStorage.games.split(',').reverse()\n    }\n}\n\nconst initialState = {\n    game: {Field: [], Turn: 0, Difficulty: 0, UserName: '', creating: false,\n        Score: {CompletedTitles: [], TotalScore: 0, ChangeImgs: [], Advices: []}},\n    error: \"\",\n    fetchingGame: gameId,\n    fetchingAdvice: false,\n    myGames: myGames,\n    createGameStatus: {hidden: true},\n    tutorialState: null\n};\n\nfunction userState(state, action) {\n    switch (action.type) {\n        case COMPLETE_GAME:\n            return {...state, game: { ...state.game, Score: {...state.game.Score, TotalScore: 0}}};\n        case GET_ADVICE:\n            var images = {};\n            for (var img of action.payload.Img) {\n                images[img] = true;\n            }\n            var newField = state.game.Field.map((char) => {\n                if (char.Img in images) {\n                    return {...char, advice: true, selected: false}\n                } else {\n                    return {...char, advice: false, selected: false}\n                }\n            });\n            return {...state, game: {...state.game, Field: newField, Score: {...state.game.Score, Advices: [...state.game.Score.Advices, action.payload]}}};\n        case CHAR_IMAGE_CHANGED:\n            var changedImages = [];\n            var newField = state.game.Field.map((char) => {\n                if (char.Img == action.payload.OldImg) {\n                    if (state.game.Score.ChangeImgs.filter(change => change.OldImg == char.Img).length == 0) {\n                        changedImages = [...state.game.Score.ChangeImgs, action.payload];\n                    } else {\n                        changedImages = state.game.Score.ChangeImgs\n                    }\n                    return {...char, Img: action.payload.NewImg}\n                }\n                return char\n            });\n            return {...state, game: {...state.game, Field: newField, Score: {...state.game.Score, ChangeImgs: changedImages}}};\n        case CHAR_SELECTED:\n            var newField = state.game.Field.map((char) => {\n                if (char.selected) {\n                    return {...char, selected: false}\n                }\n                if (char.Row == action.payload.Row && char.Col == action.payload.Col) {\n                    return {...char, selected: true}\n                }\n                return char\n            });\n            return {...state, game: {...state.game, Field: newField}};\n        case MOVE_CHARACTER:\n            var newField = state.game.Field.map((char) => {\n                if (char.Row == action.payload.char.Row && char.Col == action.payload.char.Col) {\n                    return {\n                        ...char, Row: action.payload.row, Col: action.payload.col,\n                        prevRow: char.Row, prevCol: char.Col\n                    }\n                }\n                return char\n            });\n            return {...state, game: {...state.game, Field: newField}};\n        default:\n            return state;\n\n\n    }\n}\n\nfunction viewState(state = initialState, action) {\n    switch (action.type) {\n        // Tutorial actions =====================\n        case START_TUTORIAL:\n            return {...state, tutorialState: 1};\n        case END_TUTORIAL:\n            return {...initialState};\n\n        // Game actions =========================\n        case TOGGLE_CREATE_GAME_MENU:\n            return {...state, createGameStatus: {...state.createGame, hidden: !state.createGameStatus.hidden}};\n        case GET_GAME_REQUEST:\n            return {...state, game: {...state.game, creating: true}};\n        case ADD_MY_GAME:\n            state.myGames.unshift(action.payload);\n            return {...state};\n        case GET_GAME_SUCCESS:\n            action.payload.creating = false;\n            return {...state, game: action.payload, createGameStatus: {...state.createGame, hidden: true}};\n        case GET_GAME_ERROR:\n            return {...state, game: {...state.game, creating: false}};\n        case ERROR:\n            return {...state, error: action.payload};\n        case FADE_CHARACTER:\n            var newField = state.game.Field.map((char) => {\n                if (char.Row == action.payload.row && char.Col == action.payload.col) {\n                    return {...char, toDelete: true}\n                }\n                return char\n            });\n            return {...state, game: {...state.game, Field: newField}};\n        case REMOVE_CHARACTER:\n            var newField = [];\n            state.game.Field.forEach((char) => {\n                if (char.Row != action.payload.row || char.Col != action.payload.col) {\n                    newField.push(char);\n                }\n            });\n            return {...state, game: {...state.game, Field: newField}};\n        case ADD_CHARACTER:\n            action.payload.turn = state.game.Turn;\n            state.game.Field.push(action.payload);\n            return {...state, game: {...state.game}};\n        case CHANGE_GAME_TURN:\n            return {...state, game: {...state.game, Turn: action.payload}};\n        case UPDATE_GAME_SCORE:\n            action.payload.push.apply(state.game.Score.CompletedTitles, action.payload);\n            return {...state, game: {...state.game}};\n        default:\n            // User actions =====================\n            return userState(state, action);\n    }\n}\n\nfunction thunkMiddleware({dispatch, getState}) {\n    return next => action =>\n        typeof action === 'function' ?\n            action(dispatch, getState) :\n            next(action);\n}\n\nvar Store = Redux.createStore(viewState, initialState, Redux.applyMiddleware(thunkMiddleware));\nvar Provider = ReactRedux.Provider;"]}